<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <h:head>
        <title>Facelet Title</title>
        <meta http-equiv="X-UA-Compatible" content="IE=7,8,9,10,edge"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <h:outputScript name="jsf.js" library="javax.faces"/>
        <script src="js/jquery-1.11.3.min.js" type="text/javascript"/>

        <script type="text/javascript">
            function errorIniciarTOC() {
                // Metodo que se invoca al iniciar el Applet y sirve para informar el status del inicio
                $('#formDocumentos\\:estadoInicioApplet').val(document.myApplet.getStatusInicioApplet());
                $('#formDocumentos\\:estadoRegistro').val(document.myApplet.getStatusRegistro());
                $('#formDocumentos\\:estadoCargaVista').val(document.myApplet.getStatusVista());

                alert("Estado inicio Applet: " + document.myApplet.getStatusInicioApplet() +
                        "\nEstado Registro TOC: " + document.myApplet.getStatusRegistro() +
                        "\nEstado carga vista TOC: " + document.myApplet.getStatusVista()
                        );
            }

            function errorInitSecuGen() {
                // Metodo que se invoca cuando ha ocurrido un error al iniciar el lector de huellas

                alert("Ha ocurrido un error al iniciar el lector de huellas");
            }

            function errorInitBarcodeReader() {
                // Metodo que se invoca cuando ha ocurrido un error al iniciar el lector de codigos de barras

                alert("Ha ocurrido un error al iniciar el lector de cedulas de identidad");
            }

            function nuevaVerificacion($run, $textoCabecera) {
                document.myApplet.setDataNuevaVerificacion($run, $textoCabecera);
            }

            function cancelarTOC() {
                // Metodo que se invoca al momento de presionar el boton de cerrar

                alert("Se ha presionado el boton Cancelar TOC");
            }

            function cedulaLeida() {
                // Metodo que se invoca al momento de leer una cedula de identidad

                alert("Run corresponde: " + document.myApplet.getRunCorresponde());
                if (!document.myApplet.getRunCorresponde()) {
                    // document.myApplet.cleanFormularioTOC();
                }
            }

            function initVerificacionIdentidadTOC() {
                // Metodo que se invoca al momento de iniciar la verificacion de identidad TOC
            }

            function verificacionIdentidadTOC() {
                // Metodo que se invoca al momento de obtener una verificacion de identidad TOC
                $('#formDocumentos\\:tipoCedula').val(document.myApplet.isNewID());
                document.getElementById("formDocumentos:btnFirma").disabled = false;
                if (document.myApplet.isNewID()) {


                    $('#formDocumentos\\:apellidos').val(document.myApplet.getApellidosNewCI());
                    $('#formDocumentos\\:ciVencida').val(document.myApplet.getCIVencidaNewCI());
                    $('#formDocumentos\\:nacionalidad').val(document.myApplet.getNacionalidadNewCI());
                    $('#formDocumentos\\:fechaNacimiento').val(document.myApplet.getFechaNacimientoNewCI());
                    $('#formDocumentos\\:fechaVencimiento').val(document.myApplet.getFechaVencimientoNewCI());
                    $('#formDocumentos\\:genero').val(document.myApplet.getGeneroNewCI());
                    $('#formDocumentos\\:nombres').val(document.myApplet.getNombresNewCI());
                    $('#formDocumentos\\:numeroSerie').val(document.myApplet.getNSerieNewCI());
                    $('#formDocumentos\\:numeroTransaccion').val(document.myApplet.getNTransaccionNewCI());
                    $('#formDocumentos\\:resultadoTransaccion').val(document.myApplet.getResultadoVerificacionNewCI());
                    $('#formDocumentos\\:run').val(document.myApplet.getRunNewCI());
                    alert("Resultado Operacion: " + document.myApplet.getCodigoRespuestaNewCI() +
                            "\nRun: " + document.myApplet.getRunNewCI() +
                            "\nNombres: " + document.myApplet.getNombresNewCI() +
                            "\nApellidos: " + document.myApplet.getApellidosNewCI() +
                            "\nGenero: " + document.myApplet.getGeneroNewCI() +
                            "\nNacionalidad: " + document.myApplet.getNacionalidadNewCI() +
                            "\nFecha Nacimiento: " + document.myApplet.getFechaNacimientoNewCI() +
                            "\nFecha Vencimiento CI: " + document.myApplet.getFechaVencimientoNewCI() +
                            "\nNumero Serie CI: " + document.myApplet.getNSerieNewCI() +
                            "\nNumero Transaccion TOC: " + document.myApplet.getNTransaccionNewCI() +
                            "\nResultado Transaccion: " + document.myApplet.getResultadoVerificacionNewCI() +
                            "\nCI Vencida: " + document.myApplet.getCIVencidaNewCI());
                } else {

                    alert("Resultado Operacion: " + document.myApplet.getCodigoRespuesta() +
                            "\nRun: " + document.myApplet.getRut() +
                            "\nApellido Paterno: " + document.myApplet.getApellidoPaterno() +
                            "\nNombre Completo: " + document.myApplet.getNombreCompleto() +
                            "\nNacionalidad: " + document.myApplet.getNacionalidad() +
                            "\nFecha Vencimiento CI: " + document.myApplet.getFechaVence() +
                            "\nNumero Serie CI: " + document.myApplet.getNumeroSerie() +
                            "\nPuntaje TOC: " + document.myApplet.getResultadoTrx() +
                            "\nNumero Transaccion TOC: " + document.myApplet.getNTransaccion() +
                            "\nResultado Transaccion: " + document.myApplet.getResultadoTRX() +
                            "\nCI Vencida: " + document.myApplet.getCIVencida());

                    $('#formDocumentos\\:apellidos').val(document.myApplet.getApellidoPaterno());
                    $('#formDocumentos\\:ciVencida').val(document.myApplet.getCIVencida());
                    $('#formDocumentos\\:nacionalidad').val(document.myApplet.getNacionalidad());
                    $('#formDocumentos\\:fechaVencimiento').val(document.myApplet.getFechaVence());
                    $('#formDocumentos\\:nombres').val(document.myApplet.getNombreCompleto());
                    $('#formDocumentos\\:numeroTransaccion').val(document.myApplet.getNTransaccion());
                    $('#formDocumentos\\:resultadoTransaccion').val(document.myApplet.getResultadoTRX());
                    $('#formDocumentos\\:run').val(document.myApplet.getRut());
                }
            }
        </script>

    </h:head>
    <h:body>
        <h:form id="formDocumentos">

            <applet code="jtoc\v3\Main" name="myApplet" archive="jtocv3.jar" width="540" height="160">
                <PARAM name="URLTOC" value="http://web.tocbiometrics.com/tocwebsv/ver3/wsTOC3.php" />
                <PARAM name="URLNUEVACI" value="http://web.tocbiometrics.com/tocwebsv/wsTOCNewCI.php" />
                <PARAM name="URLCHILENOS" value="https://web.tocbiometrics.com:8443/wsTOCChileans/ChileansWS" />

                <PARAM name="CancelarVisible" value="false" />

                <PARAM name="java_version" value="1.6+" />
                <PARAM name="separate_jvm" value="true" />
            </applet>

            <!--            <applet code="jtoc/v3/Main" name="myApplet" archive="jtocv3.jar" width="790" height="600">
                            <PARAM name="URLTOC" value="http://web.tocbiometrics.com/tocwebsv/ver3/wsTOC3.php" />
                            <PARAM name="URLNUEVACI" value="http://web.tocbiometrics.com/tocwebsv/wsTOCNewCI.php" />
                            <PARAM name="URLCHILENOS" value="https://web.tocbiometrics.com:8443/wsTOCChileans/ChileansWS" />
                            <PARAM name="ProxyCFG" value="user:password@proxy.bst.cl:3128" />
                            <PARAM name="textoCabecera" value="Prueba TOC" />
                            <PARAM name="CancelarVisible" value="false" />
                            <PARAM name="runXVerificar" value="1-9" />
                            <PARAM name="separate_jvm" value="true" />
                        </applet>-->

            <h:inputHidden id="apellidos" value="#{MbFirma.apellidos}"/>
            <h:inputHidden id="ciVencida" value="#{MbFirma.ciVencida}"/>
            <h:inputHidden id="nacionalidad" value="#{MbFirma.nacionalidad}"/>
            <h:inputHidden id="fechaNacimiento" value="#{MbFirma.fechaNacimiento}"/>
            <h:inputHidden id="fechaVencimiento" value="#{MbFirma.fechaVencimiento}"/>
            <h:inputHidden id="genero" value="#{MbFirma.genero}"/>
            <h:inputHidden id="nombres" value="#{MbFirma.nombres}"/>
            <h:inputHidden id="numeroSerie" value="#{MbFirma.numeroSerie}"/>
            <h:inputHidden id="numeroTransaccion" value="#{MbFirma.numeroTransaccion}"/>
            <h:inputHidden id="resultadoTransaccion" value="#{MbFirma.resultadoTransaccion}"/>
            <h:inputHidden id="run" value="#{MbFirma.run}"/>
            <h:inputText id="tipoCedula" value="#{MbFirma.tipoCedula}"/>
            <h:inputHidden id="estadoCargaVista" value="#{MbFirma.estadoCargaVista}"/>
            <h:inputHidden id="estadoInicioApplet" value="#{MbFirma.estadoInicioApplet}"/>
            <h:inputHidden id="estadoRegistro" value="#{MbFirma.estadoRegistro}"/>

            <label>Ingrese la identificación de la oferta</label>
            <h:inputText id="idOferta" value="#{MbFirma.idOferta}"/>
            <h:commandButton action="#{MbFirma.consultarDocumentos}" value="Listar"  >
                <f:ajax render="tableDocumentos" />
            </h:commandButton>




            <h:dataTable id="tableDocumentos" value="#{MbFirma.documentos}" var="o" >

                <h:column >
                    <f:facet name="header">
                        Documento
                    </f:facet>
                    #{o.nombreDocumento}
                </h:column>  

                <h:column>
                    <f:facet name="header">Ver</f:facet>
                    <h:commandLink value="Consultar"  action="#{MbFirma.consultarDocumento(o.idActividad)}" >
                        <f:ajax render="detalleDocumento" />
                    </h:commandLink>
                </h:column>
            </h:dataTable>

            <h:panelGroup id="detalleDocumento">
                <h:panelGroup layout="block">
                    <h:outputText value="#{MbFirma.detalleDocumentoVO.nombre}.#{MbFirma.detalleDocumentoVO.extension}"/>
                </h:panelGroup>
            </h:panelGroup>


            <h:commandButton id="btnFirma" action="#{MbFirma.varData}" value="Firmar" disabled="true"/>


            <div id="main">
                <div class="media" style="background-color: rgb(255, 255, 255); width: 500px;"><iframe id="pdf" src="pdfFiles/interfaces.pdf" height="400" width="500"></iframe></div>
            </div>
        </h:form>
    </h:body>
</html>

